import groovy.json.JsonSlurper
import groovy.json.JsonOutput

project.ext.ASSET_DIR = projectDir.toString() + '/src/main/assets'

task downloadModelFileRobot(type: Exec) {
    if (!System.getenv('GITHUB_TOKEN')) {
        println "Error: The environment variable GITHUB_TOKEN is not set."
        println "Please create a GitHub token with the correct permissions by following the instructions here: https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token"
        throw new GradleException("GITHUB_TOKEN is required for this task.")
    }else{
        commandLine 'echo', System.getenv('GITHUB_TOKEN'), '|','gh', 'auth', 'login', '--with-token'
        commandLine 'gh', 'release', 'download', '0.1.1', '-p', 'model.tflite', '-R', 'oist/smartphone-robot-object-detection', '-D', project.ext.ASSET_DIR, '--skip-existing'
    }
}

preBuild.dependsOn downloadModelFileRobot